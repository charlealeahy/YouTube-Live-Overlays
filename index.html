<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ISS Overlay — Live Panel (GitHub Pages)</title>
  <style>
    * { box-sizing: border-box; }
    html, body { margin:0; padding:0; width:100%; height:100%; background:#0e0f13; color:#e7eaf0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, 'Helvetica Neue', Arial, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif; }
    a { color: inherit; }
    .wrap { width: 1280px; height: 200px; padding: 10px; display: grid; grid-template-columns: 1fr; grid-auto-rows: auto; gap: 8px; }
    .title { background: linear-gradient(180deg, #13161d, #0f1218); border: 1px solid #1e2330; border-radius: 12px; padding: 14px 18px; font-size: 44px; font-weight: 600; letter-spacing: 0.4px; text-align: left; display:flex; align-items:center; gap:12px; }
    .flag { width: 48px; height: 36px; border-radius:6px; object-fit:cover; display:none; box-shadow: 0 0 0 1px #1f2533, 0 6px 18px rgba(0,0,0,.25); }
    .row { display: grid; grid-template-columns: 180px 1fr; gap: 12px; }
    .thumbbox { position: relative; background: #10131a; border: 1px solid #1b2230; border-radius: 10px; overflow: hidden; height: 90px; }
    .thumbbox .thumb { width: 100%; height: 100%; object-fit: cover; opacity: .9; filter: saturate(0.9) contrast(1.05) brightness(0.95); }
    .badge { position: absolute; left: 8px; bottom: 8px; padding: 5px 10px; border-radius: 6px; font-weight: 700; font-size: 14px; letter-spacing: .5px; background: #a01414; color: #fff; box-shadow: 0 3px 12px rgba(160,20,20,.45); }
    .badge.offline { background: #2b6cb0; box-shadow: 0 3px 12px rgba(60,110,180,.45); }
    .infobox { background: linear-gradient(180deg, #13161d, #0f1218); border: 1px solid #1e2330; border-radius: 10px; padding: 10px 14px; font-size: 18px; display: grid; grid-template-columns: 1fr; line-height: 1.5; }
    .infotitle { font-weight: 800; font-size: 22px; color:#cdd5ea; text-shadow: 0 1px 0 rgba(0,0,0,.6); margin-bottom: 4px; }
    .smallrow { display:flex; gap:24px; flex-wrap:wrap; opacity:.95; }
    .mono { font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .transparent-bg { background: transparent !important; }
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <div class="title" id="placeTitle">
      <img id="flag" class="flag" alt="Country flag" />
      <span id="placeLabel">Loading…</span>
    </div>
    <div class="row">
      <div class="thumbbox">
        <img class="thumb" id="thumb" src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=900&q=80" alt="Ocean / Earth" />
        <div class="badge" id="liveBadge">LIVE NOW</div>
      </div>
      <div class="infobox">
        <div class="infotitle" id="phase">Now: —</div>
        <div class="smallrow mono"><div id="utc">—</div></div>
        <div class="smallrow mono"><div id="speed">—</div><div id="elev">—</div></div>
        <div class="smallrow mono"><div id="coords">—</div></div>
      </div>
    </div>
  </div>
  <script>
    const CONFIG = {
      pollMs: 5000,
      useTransparentBg: false,
      showLiveBadge: true,
      liveBadgeMode: "static",
      youtubeApiKey: "",
      youtubeVideoId: "",
      geonamesUsername: "",
      flagCdnBase: "https://flagcdn.com",
    };
    if (CONFIG.useTransparentBg) {
      document.querySelectorAll('.title, .infobox, body').forEach(el => el.classList.add('transparent-bg'));
      document.body.style.background = 'transparent';
    }
    const fmt = {
      kmps: (kmh) => (kmh/3600).toFixed(4) + " km/s",
      km: (num) => num.toFixed(1) + " km",
      deg: (lat, lon) => {
        const ns = lat >= 0 ? "N" : "S";
        const ew = lon >= 0 ? "E" : "W";
        return `${Math.abs(lat).toFixed(2)} °${ns}, ${Math.abs(lon).toFixed(2)} °${ew}`;
      },
      utc: (date) => date.toISOString().replace('T', ' ').replace(/\\.\d+Z$/, ' UTC')
    };
    async function fetchJSON(url) {
      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) throw new Error("HTTP " + res.status + " for " + url);
      return res.json();
    }
    async function getISS() {
      const data = await fetchJSON("https://api.wheretheiss.at/v1/satellites/25544");
      return { lat: data.latitude, lon: data.longitude, alt_km: data.altitude, vel_kmh: data.velocity, visibility: data.visibility };
    }
    async function getPlace(lat, lon) {
      try {
        const bdc = await fetchJSON(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`);
        let label = null;
        if (bdc.localityInfo && bdc.localityInfo.informative) {
          const sea = bdc.localityInfo.informative.find(x => /Ocean|Sea|Gulf|Bay|Channel|Strait|Bight|Sound|Lake/i.test(x.name));
          if (sea) label = sea.name;
        }
        let country = bdc.countryName || "";
        let iso2 = bdc.countryCode || "";
        if (!label) { label = country ? country : "International Waters"; }
        return { label, country, iso2 };
      } catch (e) {
        if (CONFIG.geonamesUsername) {
          try {
            const g = await fetchJSON(`https://secure.geonames.org/oceanJSON?lat=${lat}&lng=${lon}&username=${CONFIG.geonamesUsername}`);
            if (g && g.ocean && g.ocean.name) return { label: g.ocean.name, country: "", iso2: "" };
          } catch (_) {}
        }
        try {
          const mr = await fetchJSON(`https://www.marineregions.org/rest/getGazetteerRecordsByLatLon.json/${lat}/${lon}/`);
          const water = Array.isArray(mr) ? mr.find(x => /Ocean|Sea|Gulf|Bay|Channel|Strait|Bight|Sound|Lake/i.test(x.preferredGazetteerName || "")) : null;
          if (water) return { label: water.preferredGazetteerName, country: "", iso2: "" };
        } catch (_) {}
        return { label: "Earth", country: "", iso2: "" };
      }
    }
    async function getSunTimes(lat, lon) {
      const j = await fetchJSON(`https://api.sunrise-sunset.org/json?lat=${lat}&lng=${lon}&formatted=0`);
      return j.status === "OK" ? j.results : null;
    }
    function currentPhase(sun) {
      if (!sun) return "—";
      const now = new Date();
      const rise = new Date(sun.sunrise);
      const set  = new Date(sun.sunset);
      const diffMin = (a,b) => Math.abs((a-b)/60000);
      if (diffMin(now, rise) <= 8) return "Sunrise";
      if (diffMin(now, set ) <= 8) return "Sunset";
      return (now >= rise && now <= set) ? "Daylight" : "Night";
    }
    async function getLiveBadgeState() {
      if (!CONFIG.showLiveBadge) return { label: "", cls: "" };
      if (CONFIG.liveBadgeMode === "youtube" && CONFIG.youtubeApiKey && CONFIG.youtubeVideoId) {
        try {
          const url = `https://www.googleapis.com/youtube/v3/videos?id=${CONFIG.youtubeVideoId}&part=snippet,liveStreamingDetails,status&key=${CONFIG.youtubeApiKey}`;
          const j = await fetchJSON(url);
          const item = j.items && j.items[0];
          const life = item && item.liveStreamingDetails;
          const status = item && item.snippet && item.snippet.liveBroadcastContent;
          const isLive = status === "live" || (life && life.actualStartTime && !life.actualEndTime);
          return isLive ? { label: "LIVE NOW", cls: "badge" } : { label: "OFFLINE", cls: "badge offline" };
        } catch (e) {}
      }
      return { label: "LIVE NOW", cls: "badge" };
    }
    async function update() {
      try {
        const iss = await getISS();
        const place = await getPlace(iss.lat, iss.lon);
        const sun = await getSunTimes(iss.lat, iss.lon);
        const phase = currentPhase(sun);
        const titleEl = document.getElementById("placeLabel");
        const flagEl = document.getElementById("flag");
        titleEl.textContent = place.label;
        if (place.iso2) {
          flagEl.src = `${CONFIG.flagCdnBase}/48x36/${place.iso2.toLowerCase()}.png`;
          flagEl.style.display = "block";
          flagEl.title = place.country;
          flagEl.alt = place.country ? `${place.country} flag` : "Flag";
        } else {
          flagEl.style.display = "none";
        }
        document.getElementById("phase").textContent = `Now: ${phase}`;
        document.getElementById("utc").textContent = new Date().toISOString().slice(0, 19).replace('T',' ') + " UTC";
        document.getElementById("speed").textContent = (iss.vel_kmh/3600).toFixed(4) + " km/s";
        document.getElementById("elev").textContent  = "Elev: " + iss.alt_km.toFixed(1) + " km";
        document.getElementById("coords").textContent = (Math.abs(iss.lat).toFixed(2)) + " °" + (iss.lat>=0?"N":"S") + ", " + (Math.abs(iss.lon).toFixed(2)) + " °" + (iss.lon>=0?"E":"W");
        const badge = await getLiveBadgeState();
        const badgeEl = document.getElementById("liveBadge");
        if (!CONFIG.showLiveBadge) {
          badgeEl.style.display = "none";
        } else {
          badgeEl.textContent = badge.label;
          badgeEl.className = badge.cls;
          badgeEl.style.display = "inline-block";
        }
      } catch (e) { console.error(e); }
    }
    update();
    setInterval(update, CONFIG.pollMs);
  </script>
</body>
</html>