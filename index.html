<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta charset="UTF-8"><title>ISS Live Overlay</title>
 
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    
    
   
    <script src="https://astroviewer.net/widgets/widgets/orbit.js"></script>
    
</head>
<style>
    body { margin: 0; padding: 0; background: transparent; color: white; font-family: Arial; }
    .panel { position: absolute; bottom: 20px; left: 20px; right: 20px;
      background: rgba(0,0,0,0.75); padding: 10px; border-radius: 10px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .info { display: flex; flex-direction: column; }
    #demographics { display: flex; flex-direction: row; }
    .badge { padding: 5px 15px; border-radius: 5px; background: red; font-weight: bold;}
    .offline { background: blue !important; }


  </style>
<body>

    <!-- Main Content -->
    <!-- <div id="main"> -->
        <!-- <div id="map">
          <iframe width="1000" height="600" src="https://www.youtube.com/watch?v=xRPjKQtRXR8" frameborder="0" allowfullscreen></iframe>
        </div> -->
    <!-- </div> -->
     <!-- 16:9 aspect ratio -->
<div class="card-body"  >
  <iframe width="1240" height="420" src="https://www.youtube.com/embed/xRPjKQtRXR8" title="ðŸ”´ Live Now: 24/7 NASA Live Stream of Earth from Space (ISS)" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
</div>
<div class="panel">
    <div class="info">
      <div id="location" style="font-size:1.5em;">--</div>
      <div id="datetime">--</div>
      <div id="stats">Speed: -- km/s â€¢ Elev: -- km</div>
      <div id="coords">--Â° N, --Â° E</div>
    </div>
    <div id="livestatus" class="badge">LIVE NOW</div>

    <div id="demographics">
	<div id="capital" style="font-size:1.5em; display:block;"></div>
      <div id="Population:" style="display:block;"></div>
      <div id="Median Age:" style="display:block;"></div>
      <div id="Renewables:" style="display:block;"></div> 
    </div>
  </div>
<!-- <div class="card border-info" id = "panel_graph" style = "display :block;">
                <div class="card-header" style = "background-color:#c4edb7; color: black; text-align:center">
                    <b>Nasa Live</b>
                </div> -->
  <!-- <div class="card-body" > 

   <div id="container1" style="height: 170px; width: 250px; display :block" >
    <iframe width="250" height="170" src="https://www.youtube.com/embed/H999s0P1Er0" title="Live High-Definition Views from the International Space Station (Official NASA Stream)" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" ></iframe>
   </div>
 
</div>
  </div>  -->
  <!------------------------------------------>
<!-- <div class="card" id = "panel_graph1" style = "display :block;">
                 <div class="card-header" style = "background-color:#c4edb7; color: black; text-align:center">
                    <b>Number of Plantation Sites</b>
                </div> -->
  <!-- <div class="card-body" > 

   
   <div id="av-orbit" style="height: 170px; width: 250px; display :block">
    
    
</div>

  


</div>
  </div> --> 
  <!----------------------------->

  
</body>

    

    <!-- Scripts -->
    
   
    <script>

      var avOrbitProperties = {
            size: 'medium',
            lang: 'en'
        };
	async function fetchISS() {
      try {
        const res = await fetch('https://api.wheretheiss.at/v1/satellites/25544');
        const data = await res.json();
        const { latitude, longitude, altitude, velocity } = data;
        const now = new Date().toUTCString();
        var lat1 = latitude;
        var long1 = longitude;
        reverseGeocode(lat1, long1);
        document.getElementById('datetime').innerText = now;
        document.getElementById('stats').innerText =
          `Speed: ${(velocity/1000).toFixed(2)} km/s â€¢ Elev: ${altitude.toFixed(1)} km`;
        document.getElementById('coords').innerText =
          `${latitude.toFixed(2)}Â° ${latitude>=0?'N':'S'}, ${longitude.toFixed(2)}Â° ${longitude>=0?'E':'W'}`;

        // Use simple fallback: lat/lon
        document.getElementById('location').innerText =
          `Lat ${latitude.toFixed(2)}, Lon ${longitude.toFixed(2)}`;
        
        // Attempt demographic fetch (may fail)
        // const country = 'world'; // simplified - full integration may fail via GitHub Pages
        // document.getElementById('demographics').innerHTML =
        //   `Capital: --<br>Population: --<br>Median Age: --<br>Renewables: --%`;
        
      } catch (e) {
        console.error(e);
        const badge = document.getElementById('livestatus');
        badge.innerText = 'OFFLINE';
        badge.classList.add('offline');
      }




    }

    fetchISS();
    setInterval(fetchISS, 10000);
    
async function reverseGeocode(lat1, long1) {


  const a = parseFloat(lat1);
  const b = parseFloat(long1);
const apiKey = '77cf65890783415cab445124ffc0a964';

  fetch(`https://api.geoapify.com/v1/geocode/reverse?lat=${lat1}&lon=${long1}&apiKey=${apiKey}`)
  .then(response => response.json())
  .then(result => {
    if (result.features && result.features.length > 0) {
      const address = result.features[0].properties.formatted;
      const myString1 = address;
const parts1 = myString1.split(',');
const lastItem1 = parts1[parts1.length - 1];
const str1 = lastItem1.replace(/^\s+/g, '')
      document.getElementById('capital').innerText = str1;
      getdata(address);
      console.log('Address:', address);
    } else {
      console.log('Address not found for the given coordinates.');
    }
  })
  .catch(error => {
    console.error('Error during reverse geocoding:', error);
  });

}



 async function getdata(address) {  

  var loc_name = address;
  const myString = address;
const parts = myString.split(',');
const lastItem = parts[parts.length - 1];
const str = lastItem.replace(/^\s+/g, '')
var loc_name = str;
console.log(lastItem);

const today = new Date();

  

const url = `https://d6wn6bmjj722w.population.io/1.0/population/${loc_name}/today-and-tomorrow/`;
fetch(url)
  .then(res => res.json())
  .then(data => {
    // Process data array for each country and year
    var  pop = [];
   
  //   var len = Object.keys(data).length;
    
   var obj = data;
 
  
    const extractNestedValues = obj => 
  Object.values(obj).flatMap(value => 
    typeof value === 'object' ? extractNestedValues(value) : value
  );
    pop = extractNestedValues(data);
      const population = pop[1];
  document.getElementById('Population:').innerText = population;
    console.log(data);
  })
  .catch(err => console.error(err));

///////////////////////////////////age///////////////////////////////

 }
    </script>

</body>

</html>
